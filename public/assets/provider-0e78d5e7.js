var t=Object.defineProperty,e=(e,s,r)=>(((e,s,r)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r})(e,"symbol"!=typeof s?s+"":s,r),r);import{k as s,l as r,D as i,m as n,n as o,o as a,q as l,s as h,v as d}from"./index-8fe412d1.js";import{VideoProvider as c}from"./provider-1ba67cbd.js";import{a as u}from"./provider-572956bc.js";class p{constructor(t,e,s){this.di=t,this.ph=e,this._e=s,this.ei()}async ei(){const t={onLoadStart:this.ge.bind(this),onLoaded:this.ue.bind(this),onLoadError:this.fi.bind(this)};let e=await async function(t,e={}){var s,i,n;if(!r(t))return;null==(s=e.onLoadStart)||s.call(e);try{if(await o(t),!a(window.Hls))throw Error("");const s=window.Hls;return null==(i=e.onLoaded)||i.call(e,s),s}catch(l){null==(n=e.onLoadError)||n.call(e,l)}return}(this.di,t);if(s(e)&&!r(this.di)&&(e=await async function(t,e={}){var r,i,n,o,a;if(s(t))return;if(null==(r=e.onLoadStart)||r.call(e),t.prototype&&t.prototype!==Function)return null==(i=e.onLoaded)||i.call(e,t),t;try{const s=null==(n=await t())?void 0:n.default;if(!s||!s.isSupported)throw Error("");return null==(o=e.onLoaded)||o.call(e,s),s}catch(l){null==(a=e.onLoadError)||a.call(e,l)}return}(this.di,t)),!e)return null;if(!e.isSupported()){const t="[vidstack]: `hls.js` is not supported in this environment";return this.ph.player.dispatchEvent(new i("hls-unsupported")),this.ph.delegate.R("error",{detail:{message:t,code:4}}),null}return e}ge(){this.ph.player.dispatchEvent(new i("hls-lib-load-start"))}ue(t){this.ph.player.dispatchEvent(new i("hls-lib-loaded",{detail:t})),this._e(t)}fi(t){const e=n(t);this.ph.player.dispatchEvent(new i("hls-lib-load-error",{detail:e})),this.ph.delegate.R("error",{detail:{message:e.message,code:4}})}}class f extends c{constructor(){super(...arguments),e(this,"$$PROVIDER_TYPE","HLS"),e(this,"mh",null),e(this,"xd",new u(this.video)),e(this,"lh","https://cdn.jsdelivr.net/npm/hls.js@^1.0.0/dist/hls.min.js")}get ctor(){return this.mh}get instance(){return this.xd.instance}get type(){return"hls"}get canLiveSync(){return!0}get config(){return this.xd.nh}set config(t){this.xd.nh=t}get library(){return this.lh}set library(t){this.lh=t}preconnect(){r(this.lh)&&h(this.lh)}setup(t){super.setup(t),new p(this.lh,t,(e=>{this.mh=e,this.xd.setup(e,t),t.delegate.R("provider-setup",{detail:this});const s=d(t.$store.source);s&&this.loadSource(s)}))}async loadSource({src:t}){var e;r(t)&&(null==(e=this.xd.instance)||e.loadSource(t))}onInstance(t){const e=this.xd.instance;return e&&t(e),this.xd.oh.add(t),()=>this.xd.oh.delete(t)}destroy(){this.xd.Jg()}}e(f,"supported",l());export{f as HLSProvider};
//# sourceMappingURL=provider-0e78d5e7.js.map
