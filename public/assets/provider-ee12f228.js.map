{"version":3,"file":"provider-ee12f228.js","sources":["../../spa/node_modules/.pnpm/vidstack@0.6.14/node_modules/vidstack/dist/prod/providers/hls/lib-loader.js","../../spa/node_modules/.pnpm/vidstack@0.6.14/node_modules/vidstack/dist/prod/providers/hls/provider.js"],"sourcesContent":["import { isUndefined, isString, DOMEvent, isFunction } from 'maverick.js/std';\nimport { Q as coerceToError, R as loadScript } from '../../media-core.js';\n\nclass HLSLibLoader {\n  constructor(_lib, _context, _callback) {\n    this.di = _lib;\n    this.ph = _context;\n    this._e = _callback;\n    this.ei();\n  }\n  async ei() {\n    const callbacks = {\n      onLoadStart: this.ge.bind(this),\n      onLoaded: this.ue.bind(this),\n      onLoadError: this.fi.bind(this)\n    };\n    let ctor = await loadHLSScript(this.di, callbacks);\n    if (isUndefined(ctor) && !isString(this.di))\n      ctor = await importHLS(this.di, callbacks);\n    if (!ctor)\n      return null;\n    if (!ctor.isSupported()) {\n      const message = \"[vidstack]: `hls.js` is not supported in this environment\";\n      this.ph.player.dispatchEvent(new DOMEvent(\"hls-unsupported\"));\n      this.ph.delegate.R(\"error\", { detail: { message, code: 4 } });\n      return null;\n    }\n    return ctor;\n  }\n  ge() {\n    this.ph.player.dispatchEvent(new DOMEvent(\"hls-lib-load-start\"));\n  }\n  ue(ctor) {\n    this.ph.player.dispatchEvent(\n      new DOMEvent(\"hls-lib-loaded\", {\n        detail: ctor\n      })\n    );\n    this._e(ctor);\n  }\n  fi(e) {\n    const error = coerceToError(e);\n    this.ph.player.dispatchEvent(\n      new DOMEvent(\"hls-lib-load-error\", {\n        detail: error\n      })\n    );\n    this.ph.delegate.R(\"error\", {\n      detail: { message: error.message, code: 4 }\n    });\n  }\n}\nasync function importHLS(loader, callbacks = {}) {\n  if (isUndefined(loader))\n    return void 0;\n  callbacks.onLoadStart?.();\n  if (loader.prototype && loader.prototype !== Function) {\n    callbacks.onLoaded?.(loader);\n    return loader;\n  }\n  try {\n    const ctor = (await loader())?.default;\n    if (ctor && !!ctor.isSupported) {\n      callbacks.onLoaded?.(ctor);\n    } else {\n      throw Error(\n        false ? \"[vidstack] failed importing `hls.js`. Dynamic import returned invalid constructor.\" : \"\"\n      );\n    }\n    return ctor;\n  } catch (err) {\n    callbacks.onLoadError?.(err);\n  }\n  return void 0;\n}\nasync function loadHLSScript(src, callbacks = {}) {\n  if (!isString(src))\n    return void 0;\n  callbacks.onLoadStart?.();\n  try {\n    await loadScript(src);\n    if (!isFunction(window.Hls)) {\n      throw Error(\n        false ? \"[vidstack] failed loading `hls.js`. Could not find a valid `Hls` constructor on window\" : \"\"\n      );\n    }\n    const ctor = window.Hls;\n    callbacks.onLoaded?.(ctor);\n    return ctor;\n  } catch (err) {\n    callbacks.onLoadError?.(err);\n  }\n  return void 0;\n}\n\nexport { HLSLibLoader as H };\n","import { peek } from 'maverick.js';\nimport { isString } from 'maverick.js/std';\nimport { U as isHLSSupported, p as preconnect } from '../../media-core.js';\nimport { VideoProvider } from '../video/provider.js';\nimport { H as HLSController } from './hls.js';\nimport { H as HLSLibLoader } from './lib-loader.js';\nimport 'maverick.js/element';\nimport '../type-check.js';\nimport '../audio/loader.js';\nimport 'maverick.js/dom';\nimport './loader.js';\nimport '../video/loader.js';\nimport '../html/provider.js';\nimport '../html/htmlâ€“media-events.js';\nimport '../../media-ui.js';\nimport '../../icons/icon.js';\nimport 'media-captions';\nimport '../html/native-audio-tracks.js';\nimport '../video/native-hls-text-tracks.js';\nimport '../video/picture-in-picture.js';\nimport '../video/presentation/video-presentation.js';\n\nconst JS_DELIVR_CDN = \"https://cdn.jsdelivr.net\";\nclass HLSProvider extends VideoProvider {\n  $$PROVIDER_TYPE = \"HLS\";\n  mh = null;\n  xd = new HLSController(this.video);\n  /**\n   * The `hls.js` constructor.\n   */\n  get ctor() {\n    return this.mh;\n  }\n  /**\n   * The current `hls.js` instance.\n   */\n  get instance() {\n    return this.xd.instance;\n  }\n  /**\n   * Whether `hls.js` is supported in this environment.\n   */\n  static supported = isHLSSupported();\n  get type() {\n    return \"hls\";\n  }\n  get canLiveSync() {\n    return true;\n  }\n  lh = `${JS_DELIVR_CDN}/npm/hls.js@^1.0.0/dist/hls${\".min.js\"}`;\n  /**\n   * The `hls.js` configuration object.\n   *\n   * @see {@link https://github.com/video-dev/hls.js/blob/master/docs/API.md#fine-tuning}\n   */\n  get config() {\n    return this.xd.nh;\n  }\n  set config(config) {\n    this.xd.nh = config;\n  }\n  /**\n   * The `hls.js` constructor (supports dynamic imports) or a URL of where it can be found.\n   *\n   * @defaultValue `https://cdn.jsdelivr.net/npm/hls.js@^1.0.0/dist/hls.min.js`\n   */\n  get library() {\n    return this.lh;\n  }\n  set library(library) {\n    this.lh = library;\n  }\n  preconnect() {\n    if (!isString(this.lh))\n      return;\n    preconnect(this.lh);\n  }\n  setup(context) {\n    super.setup(context);\n    new HLSLibLoader(this.lh, context, (ctor) => {\n      this.mh = ctor;\n      this.xd.setup(ctor, context);\n      context.delegate.R(\"provider-setup\", { detail: this });\n      const src = peek(context.$store.source);\n      if (src)\n        this.loadSource(src);\n    });\n  }\n  async loadSource({ src }) {\n    if (!isString(src))\n      return;\n    this.xd.instance?.loadSource(src);\n  }\n  /**\n   * The given callback is invoked when a new `hls.js` instance is created and right before it's\n   * attached to media.\n   */\n  onInstance(callback) {\n    const instance = this.xd.instance;\n    if (instance)\n      callback(instance);\n    this.xd.oh.add(callback);\n    return () => this.xd.oh.delete(callback);\n  }\n  destroy() {\n    this.xd.Jg();\n  }\n}\n\nexport { HLSProvider };\n"],"names":["HLSLibLoader","_lib","_context","_callback","callbacks","ctor","loadHLSScript","isUndefined","isString","importHLS","message","DOMEvent","e","error","coerceToError","loader","_a","_b","_c","_d","err","_e","src","loadScript","isFunction","JS_DELIVR_CDN","HLSProvider","VideoProvider","__publicField","HLSController","config","library","preconnect","context","peek","callback","instance","isHLSSupported"],"mappings":"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","x_google_ignoreList":[0,1]}