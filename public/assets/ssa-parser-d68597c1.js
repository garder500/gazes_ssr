var e=Object.defineProperty,t=(t,s,a)=>(((t,s,a)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a})(t,"symbol"!=typeof s?s+"":s,a),a);import{_ as s,V as a,g as i}from"./index-8fe412d1.js";const r=/^Format:[\s\t]*/,l=/^Style:[\s\t]*/,n=/^Dialogue:[\s\t]*/,c=/[\s\t]*,[\s\t]*/,o=/\{[^}]+\}/g,h=/\\N/g,u=/^\[(.*)[\s\t]?Styles\]$/,p=/^\[(.*)[\s\t]?Events\]$/;class f{constructor(){t(this,"f"),t(this,"O",0),t(this,"a",null),t(this,"j",[]),t(this,"k",[]),t(this,"N",null),t(this,"d"),t(this,"P",{})}async init(e){this.f=e,e.errors&&(this.d=(await s((()=>import("./errors-339eb9eb.js")),["assets/errors-339eb9eb.js","assets/index-8fe412d1.js","assets/index-ff040aa9.css"])).ParseErrorBuilder)}parse(e,t){var s,a;if(this.O)switch(this.O){case 1:if(""===e)this.O=0;else if(l.test(e))if(this.N){const t=e.replace(l,"").split(c);this.S(t)}else this.e(null==(s=this.d)?void 0:s.T("Style",t));else r.test(e)?this.N=e.replace(r,"").split(c):p.test(e)&&(this.N=null,this.O=2);break;case 2:if(""===e)this.Q();else if(n.test(e))if(this.Q(),this.N){const s=e.replace(n,"").split(c),a=this.U(s,t);a&&(this.a=a)}else this.e(null==(a=this.d)?void 0:a.T("Dialogue",t));else this.a?this.a.text+="\n"+e.replace(o,"").replace(h,"\n"):r.test(e)?this.N=e.replace(r,"").split(c):u.test(e)?(this.N=null,this.O=1):p.test(e)&&(this.N=null)}else""===e||(u.test(e)?(this.N=null,this.O=1):p.test(e)&&(this.N=null,this.O=2))}done(){return{metadata:{},cues:this.j,regions:[],errors:this.k}}Q(){var e,t;this.a&&(this.j.push(this.a),null==(t=(e=this.f).onCue)||t.call(e,this.a),this.a=null)}S(e){let t,s,a,i,r="Default",l={},n="center",c="bottom",o=1.2,h=3,u=[];for(let p=0;p<this.N.length;p++){const f=this.N[p],g=e[p];switch(f){case"Name":r=g;break;case"Fontname":l["font-family"]=g;break;case"Fontsize":l["font-size"]=`calc(${g} / var(--overlay-height))`;break;case"PrimaryColour":const e=d(g);e&&(l["--cue-color"]=e);break;case"BorderStyle":h=parseInt(g,10);break;case"BackColour":i=d(g);break;case"OutlineColour":const p=d(g);p&&(a=p);break;case"Bold":parseInt(g)&&(l["font-weight"]="bold");break;case"Italic":parseInt(g)&&(l["font-style"]="italic");break;case"Underline":parseInt(g)&&(l["text-decoration"]="underline");break;case"StrikeOut":parseInt(g)&&(l["text-decoration"]="line-through");break;case"Spacing":l["letter-spacing"]=g+"px";break;case"AlphaLevel":l.opacity=parseFloat(g);break;case"ScaleX":u.push(`scaleX(${parseFloat(g)/100})`);break;case"ScaleY":u.push(`scaleY(${parseFloat(g)/100})`);break;case"Angle":u.push(`rotate(${g}deg)`);break;case"Shadow":o=1.2*parseInt(g,10);break;case"MarginL":l["--cue-width"]="auto",l["--cue-left"]=parseFloat(g)+"px";break;case"MarginR":l["--cue-width"]="auto",l["--cue-right"]=parseFloat(g)+"px";break;case"MarginV":s=parseFloat(g);break;case"Outline":t=parseInt(g,10);break;case"Alignment":const f=parseInt(g,10);switch(f>=4&&(c=f>=7?"top":"center"),f%3){case 1:n="start";break;case 2:n="center";break;case 3:n="end"}}}if(l.R=c,l["--cue-white-space"]="normal",l["--cue-line-height"]="normal",l["--cue-text-align"]=n,"center"===c?(l["--cue-top"]="50%",u.push("translateY(-50%)")):l[`--cue-${c}`]=(s||0)+"px",1===h&&(l["--cue-padding-y"]="0"),(1===h||i)&&(l["--cue-bg-color"]=1===h?"none":i),3===h&&a&&(l["--cue-outline"]=`${t}px solid ${a}`),1===h&&"number"==typeof t){const e=i??"#000";l["--cue-text-shadow"]=[a&&g(1.2*t,1.2*o,a),a?g(t*(t/2),o*(t/2),e):g(t,o,e)].filter(Boolean).join(", ")}u.length&&(l["--cue-transform"]=u.join(" ")),this.P[r]=l}U(e,t){const s=this.V(e),i=this.o(s.Start,s.End,t);if(!i)return;const r=new a(i[0],i[1],""),l={...this.P[s.Style]||{}},n=s.Name?`<v ${s.Name}>`:"",c=l.R,u=s.MarginL&&parseFloat(s.MarginL),p=s.MarginR&&parseFloat(s.MarginR),f=s.MarginV&&parseFloat(s.MarginV);return u&&(l["--cue-width"]="auto",l["--cue-left"]=u+"px"),p&&(l["--cue-width"]="auto",l["--cue-right"]=p+"px"),f&&"center"!==c&&(l[`--cue-${c}`]=f+"px"),r.text=n+e.slice(this.N.length-1).join(", ").replace(o,"").replace(h,"\n"),delete l.R,Object.keys(l).length&&(r.style=l),r}V(e){const t={};for(let s=0;s<this.N.length;s++)t[this.N[s]]=e[s];return t}o(e,t,s){var a,r,l;const n=i(e),c=i(t);if(null!==n&&null!==c&&c>n)return[n,c];null===n&&this.e(null==(a=this.d)?void 0:a.q(e,s)),null===c&&this.e(null==(r=this.d)?void 0:r.r(t,s)),null!=n&&null!==c&&c>n&&this.e(null==(l=this.d)?void 0:l.s(n,c,s))}e(e){var t,s;if(e){if(this.k.push(e),this.f.strict)throw this.f.cancel(),e;null==(s=(t=this.f).onError)||s.call(t,e)}}}function d(e){const t=parseInt(e.replace("&H",""),16);if(t>=0){return"rgba("+[255&t,t>>8&255,t>>16&255,(t>>24&255^255)/255].join(",")+")"}return null}function g(e,t,s){const a=Math.ceil(2*Math.PI*e);let i="";for(let r=0;r<a;r++){const l=2*Math.PI*r/a;i+=e*Math.cos(l)+"px "+t*Math.sin(l)+"px 0 "+s+(r==a-1?"":",")}return i}function b(){return new f}export{f as SSAParser,b as default};
//# sourceMappingURL=ssa-parser-d68597c1.js.map
