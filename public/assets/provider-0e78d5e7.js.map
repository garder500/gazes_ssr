{"version":3,"file":"provider-0e78d5e7.js","sources":["../../spa/node_modules/.pnpm/vidstack@0.6.14/node_modules/vidstack/dist/prod/providers/hls/lib-loader.js","../../spa/node_modules/.pnpm/vidstack@0.6.14/node_modules/vidstack/dist/prod/providers/hls/provider.js"],"sourcesContent":["import { isUndefined, isString, DOMEvent, isFunction } from 'maverick.js/std';\nimport { Q as coerceToError, R as loadScript } from '../../media-core.js';\n\nclass HLSLibLoader {\n  constructor(_lib, _context, _callback) {\n    this.di = _lib;\n    this.ph = _context;\n    this._e = _callback;\n    this.ei();\n  }\n  async ei() {\n    const callbacks = {\n      onLoadStart: this.ge.bind(this),\n      onLoaded: this.ue.bind(this),\n      onLoadError: this.fi.bind(this)\n    };\n    let ctor = await loadHLSScript(this.di, callbacks);\n    if (isUndefined(ctor) && !isString(this.di))\n      ctor = await importHLS(this.di, callbacks);\n    if (!ctor)\n      return null;\n    if (!ctor.isSupported()) {\n      const message = \"[vidstack]: `hls.js` is not supported in this environment\";\n      this.ph.player.dispatchEvent(new DOMEvent(\"hls-unsupported\"));\n      this.ph.delegate.R(\"error\", { detail: { message, code: 4 } });\n      return null;\n    }\n    return ctor;\n  }\n  ge() {\n    this.ph.player.dispatchEvent(new DOMEvent(\"hls-lib-load-start\"));\n  }\n  ue(ctor) {\n    this.ph.player.dispatchEvent(\n      new DOMEvent(\"hls-lib-loaded\", {\n        detail: ctor\n      })\n    );\n    this._e(ctor);\n  }\n  fi(e) {\n    const error = coerceToError(e);\n    this.ph.player.dispatchEvent(\n      new DOMEvent(\"hls-lib-load-error\", {\n        detail: error\n      })\n    );\n    this.ph.delegate.R(\"error\", {\n      detail: { message: error.message, code: 4 }\n    });\n  }\n}\nasync function importHLS(loader, callbacks = {}) {\n  if (isUndefined(loader))\n    return void 0;\n  callbacks.onLoadStart?.();\n  if (loader.prototype && loader.prototype !== Function) {\n    callbacks.onLoaded?.(loader);\n    return loader;\n  }\n  try {\n    const ctor = (await loader())?.default;\n    if (ctor && !!ctor.isSupported) {\n      callbacks.onLoaded?.(ctor);\n    } else {\n      throw Error(\n        false ? \"[vidstack] failed importing `hls.js`. Dynamic import returned invalid constructor.\" : \"\"\n      );\n    }\n    return ctor;\n  } catch (err) {\n    callbacks.onLoadError?.(err);\n  }\n  return void 0;\n}\nasync function loadHLSScript(src, callbacks = {}) {\n  if (!isString(src))\n    return void 0;\n  callbacks.onLoadStart?.();\n  try {\n    await loadScript(src);\n    if (!isFunction(window.Hls)) {\n      throw Error(\n        false ? \"[vidstack] failed loading `hls.js`. Could not find a valid `Hls` constructor on window\" : \"\"\n      );\n    }\n    const ctor = window.Hls;\n    callbacks.onLoaded?.(ctor);\n    return ctor;\n  } catch (err) {\n    callbacks.onLoadError?.(err);\n  }\n  return void 0;\n}\n\nexport { HLSLibLoader as H };\n","import { peek } from 'maverick.js';\nimport { isString } from 'maverick.js/std';\nimport { U as isHLSSupported, p as preconnect } from '../../media-core.js';\nimport { VideoProvider } from '../video/provider.js';\nimport { H as HLSController } from './hls.js';\nimport { H as HLSLibLoader } from './lib-loader.js';\nimport 'maverick.js/element';\nimport '../type-check.js';\nimport '../audio/loader.js';\nimport 'maverick.js/dom';\nimport './loader.js';\nimport '../video/loader.js';\nimport '../html/provider.js';\nimport '../html/htmlâ€“media-events.js';\nimport '../../media-ui.js';\nimport '../../icons/icon.js';\nimport 'media-captions';\nimport '../html/native-audio-tracks.js';\nimport '../video/native-hls-text-tracks.js';\nimport '../video/picture-in-picture.js';\nimport '../video/presentation/video-presentation.js';\n\nconst JS_DELIVR_CDN = \"https://cdn.jsdelivr.net\";\nclass HLSProvider extends VideoProvider {\n  $$PROVIDER_TYPE = \"HLS\";\n  mh = null;\n  xd = new HLSController(this.video);\n  /**\n   * The `hls.js` constructor.\n   */\n  get ctor() {\n    return this.mh;\n  }\n  /**\n   * The current `hls.js` instance.\n   */\n  get instance() {\n    return this.xd.instance;\n  }\n  /**\n   * Whether `hls.js` is supported in this environment.\n   */\n  static supported = isHLSSupported();\n  get type() {\n    return \"hls\";\n  }\n  get canLiveSync() {\n    return true;\n  }\n  lh = `${JS_DELIVR_CDN}/npm/hls.js@^1.0.0/dist/hls${\".min.js\"}`;\n  /**\n   * The `hls.js` configuration object.\n   *\n   * @see {@link https://github.com/video-dev/hls.js/blob/master/docs/API.md#fine-tuning}\n   */\n  get config() {\n    return this.xd.nh;\n  }\n  set config(config) {\n    this.xd.nh = config;\n  }\n  /**\n   * The `hls.js` constructor (supports dynamic imports) or a URL of where it can be found.\n   *\n   * @defaultValue `https://cdn.jsdelivr.net/npm/hls.js@^1.0.0/dist/hls.min.js`\n   */\n  get library() {\n    return this.lh;\n  }\n  set library(library) {\n    this.lh = library;\n  }\n  preconnect() {\n    if (!isString(this.lh))\n      return;\n    preconnect(this.lh);\n  }\n  setup(context) {\n    super.setup(context);\n    new HLSLibLoader(this.lh, context, (ctor) => {\n      this.mh = ctor;\n      this.xd.setup(ctor, context);\n      context.delegate.R(\"provider-setup\", { detail: this });\n      const src = peek(context.$store.source);\n      if (src)\n        this.loadSource(src);\n    });\n  }\n  async loadSource({ src }) {\n    if (!isString(src))\n      return;\n    this.xd.instance?.loadSource(src);\n  }\n  /**\n   * The given callback is invoked when a new `hls.js` instance is created and right before it's\n   * attached to media.\n   */\n  onInstance(callback) {\n    const instance = this.xd.instance;\n    if (instance)\n      callback(instance);\n    this.xd.oh.add(callback);\n    return () => this.xd.oh.delete(callback);\n  }\n  destroy() {\n    this.xd.Jg();\n  }\n}\n\nexport { HLSProvider };\n"],"names":["HLSLibLoader","constructor","_lib","_context","_callback","this","di","ph","_e","ei","callbacks","onLoadStart","ge","bind","onLoaded","ue","onLoadError","fi","ctor","async","src","isString","_a","call","loadScript","isFunction","window","Hls","Error","_b","err","_c","loadHLSScript","isUndefined","loader","prototype","Function","default","isSupported","_d","importHLS","message","player","dispatchEvent","DOMEvent","delegate","R","detail","code","e","error","coerceToError","HLSProvider","VideoProvider","super","arguments","__publicField","HLSController","video","mh","instance","xd","type","canLiveSync","config","nh","library","lh","preconnect","setup","context","peek","$store","source","loadSource","onInstance","callback","oh","add","delete","destroy","Jg","isHLSSupported"],"mappings":"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","x_google_ignoreList":[0,1]}