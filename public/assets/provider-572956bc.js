var t=Object.defineProperty,i=(i,s,h)=>(((i,s,h)=>{s in i?t(i,s,{enumerable:!0,configurable:!0,writable:!0,value:h}):i[s]=h})(i,"symbol"!=typeof s?s+"":s,h),h);import{v as s,D as h,I as e,B as a,J as r,x as n,z as d,K as l,L as o,S as c,M as u,N as g,k,O as p,Q as b,w as m,R as y,U as w,W as v,X as T,Y as R,Z as f,$ as j,a0 as z,l as E}from"./index-8fe412d1.js";class x{constructor(t){i(this,"xi"),this._e=t}J(){k(this.xi)&&this.yi()}K(){p(this.xi)&&window.cancelAnimationFrame(this.xi),this.xi=void 0}yi(){this.xi=window.requestAnimationFrame((()=>{k(this.xi)||(this._e(),this.yi())}))}}class q{constructor(t){i(this,"ph"),i(this,"za",null),i(this,"gi",null),i(this,"nh",{}),i(this,"oh",new Set),this.aa=t}get instance(){return this.za}setup(t,i){this.ph=i;const n=s(i.$store.streamType).includes("live"),d=s(i.$store.streamType).includes("ll-");this.za=new t({lowLatencyMode:d,backBufferLength:d?4:n?8:void 0,renderTextTracksNatively:!1,...this.nh});const l=this.hi.bind(this);for(const s of Object.values(t.Events))this.za.on(s,l);this.za.on(t.Events.ERROR,this.Wb.bind(this));for(const s of this.oh)s(this.za);i.player.dispatchEvent(new h("hls-instance",{detail:this.za})),this.za.attachMedia(this.aa),this.za.on(t.Events.AUDIO_TRACK_SWITCHED,this.ii.bind(this)),this.za.on(t.Events.LEVEL_SWITCHED,this.ji.bind(this)),this.za.on(t.Events.LEVEL_LOADED,this.ki.bind(this)),this.za.on(t.Events.NON_NATIVE_TEXT_TRACKS_FOUND,this.li.bind(this)),this.za.on(t.Events.CUES_PARSED,this.mi.bind(this)),i.qualities[e]=this.ni.bind(this),a(i.qualities,"change",this.Ff.bind(this)),a(i.audioTracks,"change",this.oi.bind(this)),this.gi=r(this.pi.bind(this))}pi(){if(!this.ph.$store.live())return;const t=new x(this.qi.bind(this));return t.J(),t.K.bind(t)}qi(){var t;this.ph.$store.liveSyncPosition.set((null==(t=this.za)?void 0:t.liveSyncPosition)??1/0)}hi(t,i){this.ph.player.dispatchEvent(new h(b(t),{detail:i}))}li(t,i){const s=new h(t,{detail:i});let e=-1;for(let h=0;h<i.tracks.length;h++){const t=i.tracks[h],a=t.subtitleTrack??t.closedCaptions,r=new n({id:`hls-${t.kind}${h}`,src:null==a?void 0:a.url,label:t.label,language:null==a?void 0:a.lang,kind:t.kind});r[d]=2,r[l]=()=>{"showing"===r.mode?(this.za.subtitleTrack=h,e=h):e===h&&(this.za.subtitleTrack=-1,e=-1)},t.default&&r.setMode("showing",s),this.ph.textTracks.add(r,s)}}mi(t,i){const s=this.ph.textTracks.getById(`hls-${i.track}`);if(!s)return;const e=new h(t,{detail:i});for(const h of i.cues)h.positionAlign="auto",s.addCue(h,e)}ii(t,i){const s=this.ph.audioTracks[i.id];s&&this.ph.audioTracks[o](s,!0,new h(t,{detail:i}))}ji(t,i){const s=this.ph.qualities[i.level];s&&this.ph.qualities[o](s,!0,new h(t,{detail:i}))}ki(t,i){if(this.ph.$store.canPlay())return;const{type:s,live:e,totalduration:a}=i.details,r=new h(t,{detail:i});this.ph.delegate.R("stream-type-change",{detail:e?"EVENT"===s&&Number.isFinite(a)?"live:dvr":"live":"on-demand",trigger:r}),this.ph.delegate.R("duration-change",{detail:a,trigger:r});const n=this.za.media;-1===this.za.currentLevel&&this.ph.qualities[c](!0,r);for(const h of this.za.audioTracks)this.ph.audioTracks[u]({id:h.id+"",label:h.name,language:h.lang||"",kind:"main"},r);for(const h of this.za.levels)this.ph.qualities[u]({width:h.width,height:h.height,codec:h.codecSet,bitrate:h.bitrate},r);n.dispatchEvent(new h("canplay",{trigger:r}))}Wb(t,i){var s,h,e;if(i.fatal)switch(i.type){case"networkError":null==(s=this.za)||s.startLoad();break;case"mediaError":null==(h=this.za)||h.recoverMediaError();break;default:null==(e=this.za)||e.destroy(),this.za=null}}ni(){this.za&&(this.za.currentLevel=-1)}Ff(){const{qualities:t}=this.ph;this.za&&!t.auto&&(this.za[t.switch+"Level"]=t.selectedIndex,g&&(this.aa.currentTime=this.aa.currentTime))}oi(){const{audioTracks:t}=this.ph;this.za&&this.za.audioTrack!==t.selectedIndex&&(this.za.audioTrack=t.selectedIndex)}Jg(){var t,i;this.ph&&(this.ph.qualities[e]=void 0),null==(t=this.za)||t.destroy(),this.za=null,null==(i=this.gi)||i.call(this),this.gi=null}}class ${constructor(t,s){i(this,"ih",y()),i(this,"yh",!1),i(this,"Bh",!1),i(this,"Ch",!1),i(this,"zh",new x(this.Ih.bind(this))),i(this,"$h"),i(this,"bi"),this.j=t,this.ph=s,this.Fh(),r(this.Gh.bind(this)),m(this.Hh.bind(this))}get k(){return this.j.media}get jg(){return this.ph.delegate}Hh(){this.zh.K(),this.ih.empty()}Ih(){const t=this.j.currentTime;this.ph.$store.currentTime()!==t&&this.xh(t)}Fh(){this.wh("loadstart",this.ge),this.wh("abort",this.Dh),this.wh("emptied",this.Jh),this.wh("error",this.Wb)}Kh(){this.Bh||(this.ih.add(this.wh("loadeddata",this.Lh),this.wh("loadedmetadata",this.Mh),this.wh("canplay",this.Rb),this.wh("canplaythrough",this.Nh),this.wh("durationchange",this.Oh),this.wh("play",this.Ph),this.wh("progress",this.Qh),this.wh("stalled",this.Rh),this.wh("suspend",this.Sh)),this.Bh=!0)}Th(){this.Ch||(this.ih.add(this.wh("pause",this.Uh),this.wh("playing",this.Vh),this.wh("ratechange",this.Wh),this.wh("seeked",this.Xh),this.wh("seeking",this.Yh),this.wh("ended",this.Zh),this.wh("volumechange",this.ac),this.wh("waiting",this._h)),this.Ch=!0)}wh(t,i){return a(this.k,t,i.bind(this))}ci(t){}xh(t,i){this.jg.R("time-update",{detail:{currentTime:Math.min(t,this.ph.$store.seekableEnd()),played:this.k.played},trigger:i})}ge(t){3!==this.k.networkState?(this.Kh(),this.jg.R("load-start",{trigger:t})):this.Dh(t)}Dh(t){this.jg.R("abort",{trigger:t})}Jh(){this.jg.R("emptied",{trigger:event})}Lh(t){this.jg.R("loaded-data",{trigger:t})}Mh(t){this.Eh(),this.Th(),this.jg.R("volume-change",{detail:{volume:this.k.volume,muted:this.k.muted}}),this.jg.R("loaded-metadata",{trigger:t}),w&&v(this.ph.$store.source())&&this.jg.af(this.Ah(),t)}Ah(){return{duration:this.k.duration,buffered:this.k.buffered,seekable:this.k.seekable}}Eh(){const t=!Number.isFinite(this.k.duration);this.jg.R("stream-type-change",{detail:t?"live":"on-demand"})}Ph(t){this.ph.$store.canPlay&&this.jg.R("play",{trigger:t})}Uh(t){(1!==this.k.readyState||this.yh)&&(this.yh=!1,this.zh.K(),this.jg.R("pause",{trigger:t}))}Rb(t){this.jg.af(this.Ah(),t)}Nh(t){this.ph.$store.started()||this.jg.R("can-play-through",{trigger:t,detail:this.Ah()})}Vh(t){this.yh=!1,this.jg.R("playing",{trigger:t}),this.zh.J()}Rh(t){this.jg.R("stalled",{trigger:t}),this.k.readyState<3&&(this.yh=!0,this.jg.R("waiting",{trigger:t}))}_h(t){this.k.readyState<3&&(this.yh=!0,this.jg.R("waiting",{trigger:t}))}Zh(t){this.zh.K(),this.xh(this.k.duration,t),this.jg.R("end",{trigger:t}),this.ph.$store.loop()?this.ai():this.jg.R("ended",{trigger:t})}Gh(){this.ph.$store.paused()&&a(this.k,"timeupdate",this.Vb.bind(this))}Vb(t){this.xh(this.k.currentTime,t)}Oh(t){this.Eh(),this.ph.$store.ended()&&this.xh(this.k.duration,t),this.jg.R("duration-change",{detail:this.k.duration,trigger:t})}ac(t){this.jg.R("volume-change",{detail:{volume:this.k.volume,muted:this.k.muted},trigger:t})}Xh(t){this.xh(this.k.currentTime,t),this.jg.R("seeked",{detail:this.k.currentTime,trigger:t}),Math.trunc(this.k.currentTime)===Math.trunc(this.k.duration)&&T(this.k.duration)>T(this.k.currentTime)&&(this.xh(this.k.duration,t),this.k.ended||this.ph.player.dispatchEvent(new h("media-play-request",{trigger:t})))}Yh(t){this.jg.R("seeking",{detail:this.k.currentTime,trigger:t})}Qh(t){this.jg.R("progress",{detail:{buffered:this.k.buffered,seekable:this.k.seekable},trigger:t})}ai(){R(this.k.controls)&&(this.k.controls=!1),this.ph.player.dispatchEvent(new h("media-loop-request"))}Sh(t){this.jg.R("suspend",{trigger:t})}Wh(t){this.jg.R("rate-change",{detail:this.k.playbackRate,trigger:t})}Wb(t){const i=this.k.error;i&&this.jg.R("error",{detail:{message:i.message,code:i.code,mediaError:i},trigger:t})}}class S{constructor(t,i){this.j=t,this.ph=i,this.qh.onaddtrack=this.sh.bind(this),this.qh.onremovetrack=this.th.bind(this),this.qh.onchange=this.uh.bind(this),a(this.ph.audioTracks,"change",this.vh.bind(this))}get qh(){return this.j.media.audioTracks}sh(t){const i=t.track;if(""===i.label)return;const s={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.ph.audioTracks[u](s,t),i.enabled&&(s.selected=!0)}th(t){const i=this.ph.audioTracks.getById(t.track.id);i&&this.ph.audioTracks[f](i,t)}uh(t){let i=this.rh();if(!i)return;const s=this.ph.audioTracks.getById(i.id);s&&this.ph.audioTracks[o](s,!0,t)}rh(){return Array.from(this.qh).find((t=>t.enabled))}vh(t){const{current:i}=t.detail;if(!i)return;const s=this.qh.getTrackById(i.id);if(s){const t=this.rh();t&&(t.enabled=!1),s.enabled=!0}}}class L{constructor(t){this.k=t}setup(t){new $(this,t),"audioTracks"in this.media&&new S(this,t)}get type(){return""}get media(){return this.k}get paused(){return this.k.paused}get muted(){return this.k.muted}set muted(t){this.k.muted=t}get volume(){return this.k.volume}set volume(t){this.k.volume=t}get currentTime(){return this.k.currentTime}set currentTime(t){this.k.currentTime=t}get playsinline(){return this.k.hasAttribute("playsinline")}set playsinline(t){j(this.k,"playsinline",t)}get playbackRate(){return this.k.playbackRate}set playbackRate(t){this.k.playbackRate=t}async play(){return this.k.play()}async pause(){return this.k.pause()}async loadSource({src:t},i){this.k.preload=i,z(t)?this.k.srcObject=t:(this.k.srcObject=null,this.k.src=E(t)?t:window.URL.createObjectURL(t)),this.k.load()}}export{L as H,q as a};
//# sourceMappingURL=provider-572956bc.js.map
